name: Gemini Assistant

on:
  issue_comment:
    types: [created]

permissions:
  contents: read
  issues: write

jobs:
  gemini-assistant:
    if: contains(github.event.comment.body, '@gemini')
    runs-on: ubuntu-latest

    steps:
      - name: Check out code
        uses: actions/checkout@v4

      - name: Extract comment content
        id: extract
        run: |
          echo "COMMENT_BODY<<EOF" >> $GITHUB_ENV
          echo "${{ github.event.comment.body }}" >> $GITHUB_ENV
          echo "EOF" >> $GITHUB_ENV

      - name: Ask Gemini
        id: gemini
        run: |
          COMMENT="${{ github.event.comment.body }}"
          echo "User said: $COMMENT"
          RESPONSE=$(curl -s -X POST "https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-pro:generateContent?key=${{ secrets.GEMINI_API_KEY }}" \
            -H "Content-Type: application/json" \
            -d "{
              \"contents\": [{\"parts\": [{\"text\": \"ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½ä»£ç åŠ©æ‰‹ã€‚è¯·é’ˆå¯¹ä»¥ä¸‹è¯„è®ºè¿›è¡Œå›ç­”æˆ–ä»£ç åˆ†æï¼š${COMMENT}\"}]}]
            }" | jq -r '.candidates[0].content.parts[0].text')
          echo "Gemini response: $RESPONSE"
          echo "RESPONSE=$RESPONSE" >> $GITHUB_ENV

      - name: Reply with Gemini answer
        uses: peter-evans/create-or-update-comment@v4
        with:
          issue-number: ${{ github.event.issue.number }}
          body: |
            ğŸ¤– **Gemini æ™ºèƒ½åŠ©æ‰‹å›å¤ï¼š**
            ---
            ${{ env.RESPONSE }}

